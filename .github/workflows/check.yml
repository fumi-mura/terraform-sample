name: Check
on:
  # Push or PRä½œæˆã•ã‚ŒãŸã‚‰èµ·å‹•
  pull_request:
    branches: develop
permissions:
  id-token: write
  contents: read
  issues: write # PRã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ãŸã‚ã«è¿½åŠ 
env:
  WORKING_DIRECTORY: "terraform/aws/iam/dev"
jobs:
  check:
    runs-on: ubuntu-latest
    # GitHubã®Environments Secretsã‹ã‚‰å„ç’°å¢ƒã«ç™»éŒ²ã—ã¦ã‚ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
    environment: dev
      # todo
#     steps:
#       - name: Checkout infra repository
#         uses: actions/checkout@v4
#         with:
#           ref: develop # developãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
#       - name: Check Repository
#         run: |
#           echo "This repository"
#           git branch
#       - name: Configure AWS credentials
#         uses: aws-actions/configure-aws-credentials@v4
#         with:
#           role-to-assume: ${{ secrets.OIDC_ROLE_ARN }}
#           aws-region: ap-northeast-1
#       - name: Setup
#         uses: hashicorp/setup-terraform@v2
#         with:
#           terraform_version: 1.9.0
#       - name: Init
#         run: terraform init
#         working-directory: ${{ env.WORKING_DIRECTORY }}
#       - name: Format
#         id: fmt
#         run: terraform fmt -check -recursive
#         working-directory: ${{ env.WORKING_DIRECTORY }}
#         continue-on-error: true # ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚æ­¢ã¾ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
#       - name: Plan
#         run: terraform plan -no-color
#         working-directory: ${{ env.WORKING_DIRECTORY }}
#         continue-on-error: true # ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚æ­¢ã¾ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹

#       # plançµæœã‚’GitHubã®PRã®ã‚³ãƒ¡ãƒ³ãƒˆã«å‡ºåŠ›ã™ã‚‹
#       - name: Comment PR
#         uses: actions/github-script@v3
#         env:
#           PLAN: "terraform\n${{ steps.plan.outputs.stdout }}"
#         with:
#           github-token: ${{ secrets.GITHUB_TOKEN }} # GithubãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨
#           script: |
#             const output = `
#             #### Terraform Format and Style ğŸ–Œ\`${{ steps.fmt.outcome }}\`
#             #### Terraform Plan ğŸ“–\`${{ steps.plan.outcome }}\`
#             <details><summary>Show Plan</summary>
#             \`\`\`terraform${process.env.PLAN}\`\`\`
#             </details>`;
#             github.issues.createComment({
#               issue_number: context.issue.number,
#               owner: context.repo.owner,
#               repo: context.repo.repo,
#               body: output
#             });
